<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pm.rc.manager">

	<select id="grApplySelect" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT G.GR_ID, G.GR_NAME, M.MEM_NAME,TO_CHAR(G.GR_REGDATE, 'YYYYMMDD') GR_REGDATE
		FROM RC_GROUP G, RC_MEMBER M
		WHERE G.GR_APPYN = 'N'
		AND M.MEM_ID = (SELECT GM.MEM_ID FROM RC_GROUPMEM GM WHERE GM.GR_ID =G.GR_ID AND GM.GR_LEVEL = 'GM')
		AND G.GR_DELYN = 'N'
		<if test="gr_name != null">
			AND G.GR_NAME LIKE 	'%'||#{gr_name}||'%'
		</if>
	</select>
	
	<update id="grAppModify" parameterType="java.lang.String">
	UPDATE RC_GROUP SET GR_APPYN = 'Y'
	WHERE GR_ID = #{gr_id}
	</update>
	
	<delete id="grDelete" parameterType="java.lang.String">
	DELETE FROM RC_GROUP	
	WHERE GR_ID = #{gr_id}
	</delete>
	
	<delete id="grDelete2" parameterType="java.lang.String">
	DELETE FROM RC_GROUPMEM
	WHERE GR_ID = #{gr_id}
	</delete>
	
	<select id="grApplySelectGroup" parameterType="java.lang.String" resultType="java.util.Map">
	SELECT  G.GR_NAME, M.MEM_NAME, G.GR_GOAL, TO_CHAR(G.GR_REGDATE, 'YYYY/MM/DD') GR_REGDATE
	FROM RC_GROUP G, RC_MEMBER M
  	WHERE G.GR_ID = #{gr_id} AND M.MEM_ID = 
    (SELECT GM.MEM_ID FROM RC_GROUPMEM GM WHERE GM.GR_ID = G.GR_ID AND GM.GR_LEVEL = 'GM')
	</select>
	
	<insert id="noticeInsert_1" parameterType="java.util.Map">
		INSERT INTO RC_SYSATTACH (SATT_SEQ, SBR_UUID, SATT_NAME, SATT_SIZE, SATT_RNAME, SATT_PATH)
		VALUES
		(SYSATTACH_SEQ.NEXTVAL, #{sbr_uuid}, #{satt_name}, #{satt_size}, #{satt_rname}, #{satt_path})
	</insert>
	
	<insert id="noticeInsert_2" parameterType="java.util.Map">
		INSERT INTO RC_SYSBOARD (SBR_UUID, SBR_TITLE, SBR_CONTENT, MEM_ID, SBR_NOTICEYN, SBR_REFER)
		VALUES
		(#{sbr_uuid}, #{sbr_title}, #{sbr_content}, #{mem_id}, 'Y', (SELECT NVL(MAX(SBR_REFER)+1, 1) FROM RC_SYSBOARD))
	</insert>
	
	<update id="noticeModify_1" parameterType="java.util.Map">
		UPDATE RC_SYSATTACH SET SATT_NAME = #{satt_name}, SATT_SIZE = #{satt_size}, SATT_PATH = #{satt_path}, SATT_RNAME = #{satt_rname}
		WHERE SBR_UUID = #{sbr_uuid}
	</update>
	
	<update id="noticeModify_2" parameterType="java.util.Map">
		UPDATE RC_SYSBOARD SET SBR_TITLE = #{sbr_title}, SBR_CONTENT = #{sbr_content}
		WHERE SBR_UUID = #{sbr_uuid}
	</update>
	
	<insert id="qnaReplyInsert_1" parameterType="java.util.Map">
		INSERT INTO RC_SYSATTACH (SATT_SEQ, SBR_UUID, SATT_NAME, SATT_SIZE, SATT_RNAME, SATT_PATH)
		VALUES
		(SYSATTACH_SEQ.NEXTVAL, #{sbr_uuid}, #{satt_name}, #{satt_size}, #{satt_rname}, #{satt_path})
	</insert>
	
	<insert id="qnaReplyInsert_2" parameterType="java.util.Map">
		INSERT INTO RC_SYSBOARD (SBR_UUID, SBR_TITLE, SBR_CONTENT, MEM_ID, SBR_NOTICEYN, SBR_REFER, SBR_STEP)
		VALUES
		(#{sbr_uuid}, #{sbr_title}, #{sbr_content}, #{mem_id}, 'Y', (SELECT NVL(MAX(SBR_REFER)+1, 1) FROM RC_SYSBOARD))
	</insert>
	
	
	
</mapper>
