<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pm.rc.manager">

	<select id="grApplySelect" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT G.GR_ID, G.GR_NAME, M.MEM_NAME,TO_CHAR(G.GR_REGDATE, 'YYYYMMDD') GR_REGDATE
		FROM RC_GROUP G, RC_MEMBER M
		WHERE G.GR_APPYN = 'N'
		AND M.MEM_ID = (SELECT GM.MEM_ID FROM RC_GROUPMEM GM WHERE GM.GR_ID =G.GR_ID AND GM.GR_LEVEL = 'GM')
		AND G.GR_DELYN = 'N'
		<if test="gr_name != null">
			AND G.GR_NAME LIKE 	'%'||#{gr_name}||'%'
		</if>
	</select>
	
	<update id="grAppModify" parameterType="java.lang.String">
	UPDATE RC_GROUP SET GR_APPYN = 'Y'
	WHERE GR_ID = #{gr_id}
	</update>
	
	<delete id="grDelete" parameterType="java.lang.String">
	DELETE FROM RC_GROUP	
	WHERE GR_ID = #{gr_id}
	</delete>
	
	<delete id="grDelete2" parameterType="java.lang.String">
	DELETE FROM RC_GROUPMEM
	WHERE GR_ID = #{gr_id}
	</delete>
	
	<select id="grApplySelectGroup" parameterType="java.lang.String" resultType="java.util.Map">
	SELECT  G.GR_NAME, M.MEM_NAME, G.GR_GOAL, TO_CHAR(G.GR_REGDATE, 'YYYY/MM/DD') GR_REGDATE
	FROM RC_GROUP G, RC_MEMBER M
  	WHERE G.GR_ID = #{gr_id} AND M.MEM_ID = 
    (SELECT GM.MEM_ID FROM RC_GROUPMEM GM WHERE GM.GR_ID = G.GR_ID AND GM.GR_LEVEL = 'GM')
	</select>
	
	<insert id="noticeInsert_1" parameterType="java.util.Map">
		INSERT INTO RC_SYSATTACH (SATT_SEQ, SBR_UUID, SATT_NAME, SATT_SIZE, SATT_RNAME, SATT_PATH)
		VALUES
		(SYSATTACH_SEQ.NEXTVAL, #{sbr_uuid}, #{satt_name}, #{satt_size}, #{satt_rname}, #{satt_path})
	</insert>
	
	<insert id="noticeInsert_2" parameterType="java.util.Map">
		INSERT INTO RC_SYSBOARD (SBR_UUID, SBR_TITLE, SBR_CONTENT, MEM_ID, SBR_NOTICEYN, SBR_REFER)
		VALUES
		(#{sbr_uuid}, #{sbr_title}, #{sbr_content}, #{mem_id}, 'Y', (SELECT NVL(MAX(SBR_REFER)+1, 1) FROM RC_SYSBOARD))
	</insert>
	
	<update id="noticeModify_1" parameterType="java.util.Map">
		UPDATE RC_SYSATTACH SET SATT_NAME = #{satt_name}, SATT_SIZE = #{satt_size}, SATT_PATH = #{satt_path}, SATT_RNAME = #{satt_rname}
		WHERE SBR_UUID = #{sbr_uuid}
	</update>
	
	<update id="noticeModify_2" parameterType="java.util.Map">
		UPDATE RC_SYSBOARD SET SBR_TITLE = #{sbr_title}, SBR_CONTENT = #{sbr_content}
		WHERE SBR_UUID = #{sbr_uuid}
	</update>
	
	<insert id="qnaReplyInsert_1" parameterType="java.util.Map">
		INSERT INTO RC_SYSATTACH (SATT_SEQ, SBR_UUID, SATT_NAME, SATT_SIZE, SATT_RNAME, SATT_PATH)
		VALUES
		(SYSATTACH_SEQ.NEXTVAL, #{sbr_uuid}, #{satt_name}, #{satt_size}, #{satt_rname}, #{satt_path})
	</insert>
	
	<insert id="qnaReplyInsert_2" parameterType="java.util.Map">
		INSERT INTO RC_SYSBOARD (SBR_UUID, SBR_TITLE, SBR_CONTENT, MEM_ID, SBR_NOTICEYN, SBR_REFER, SBR_STEP, SBR_DEPTH)
		VALUES
		(#{sbr_uuid}, '└'||#{sbr_title}, #{sbr_content}, #{mem_id}, 'N', 
		(SELECT SBR_REFER FROM RC_SYSBOARD WHERE SBR_UUID = #{Rsbr_uuid}),
		(SELECT MAX(SBR_STEP)+1 FROM RC_SYSBOARD WHERE SBR_REFER = (SELECT SBR_REFER FROM RC_SYSBOARD WHERE SBR_UUID = #{Rsbr_uuid})),
		(SELECT SBR_DEPTH+1 FROM RC_SYSBOARD WHERE SBR_UUID = #{Rsbr_uuid}))
	</insert>
	
<!-- 	회원목록 페이징 처리  -->
	<select id="allMemberSelect" resultType="MemberDto" parameterType="ManagePagingDto">
	SELECT *
		FROM ( SELECT ROWNUM RNUM, P.*
		      FROM (
					SELECT MEM_ID, MEM_NAME, MEM_EMAIL, MEM_PHONE, TO_CHAR(MEM_REGDATE, 'YYYY/MM/DD') MEM_REGDATE
					FROM RC_MEMBER
					WHERE MEM_DELYN = 'N' AND MEM_LEVEL = 'N'
					ORDER BY MEM_REGDATE
		      ) P
		    )	
		WHERE RNUM BETWEEN #{start} AND #{last}	
	</select>
	
	<select id="allMemberSelectCount" resultType="java.lang.Integer">
	SELECT NVL(COUNT(*),0)
	FROM RC_MEMBER
	WHERE MEM_DELYN = 'N' AND MEM_LEVEL = 'N'
	</select>
	
<!-- 	페이징처리 끝 -->
	
	<select id="allMemberSelectSearch" parameterType="java.util.Map" resultType="MemberDto">
		SELECT MEM_ID, MEM_NAME, MEM_EMAIL, MEM_PHONE, TO_CHAR(MEM_REGDATE, 'YYYY/MM/DD') MEM_REGDATE
		FROM RC_MEMBER
		WHERE MEM_DELYN = 'N' AND MEM_LEVEL = 'N'
		AND MEM_ID LIKE '%${mem_id}%' OR MEM_NAME LIKE '%${mem_id}%'
		ORDER BY MEM_REGDATE
	</select>
	
	
	
</mapper>
